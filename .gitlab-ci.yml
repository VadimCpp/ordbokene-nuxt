stages:
  - build
  - deploy

image: node:16

build-dev:
  tags:
    - spraaksamlingene_01
  stage: build
  script:
  - npm install
  - npm run build
  artifacts:
    expire_in: "1 week"
    paths:
    - .output


deploy-dev:

  tags:
    - spraaksamlingene_01
  stage: deploy
  rules:
  - if: '$CI_COMMIT_BRANCH !~ /^WIP(.?)*/'
    when: always
  - when: manual

  before_script:
  - eval $(ssh-agent -s)
  - echo "$NREC_DEV_KEY" | base64 --decode | ssh-add -

  script:
  - ssh -o StrictHostKeyChecking=no node@$NREC_DEV_IP
    "sudo /usr/bin/systemctl stop nuxt-dev.service &&
    whoami &&
    rm -rf /node/.output"
  - scp -r .output node@$NREC_DEV_IP:/node/.output
  - ssh -o StrictHostKeyChecking=no node@$NREC_DEV_IP
    sudo /usr/bin/systemctl start nuxt-dev.service

    
